<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>C# 委托 &#8211; Maple Story</title> <meta name="description" content="串口通讯开发、C#开发"> <meta name="keywords" content="C#"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="C# 委托"> <meta name="twitter:description" content="串口通讯开发、C#开发"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="C# 委托"> <meta property="og:description" content="串口通讯开发、C#开发"> <meta property="og:url" content="https://www.maplestory.work/C-%E5%A7%94%E6%89%98/"> <meta property="og:site_name" content="Maple Story"> <meta property="og:image" content="https://www.maplestory.work/images/halve.png"> <link rel="canonical" href="https://www.maplestory.work/C-%E5%A7%94%E6%89%98/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="https://www.maplestory.work/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="https://www.maplestory.work/favicon.png" /> <link rel="shortcut icon" href="https://www.maplestory.work/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="https://www.maplestory.work/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://www.maplestory.work/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://www.maplestory.work/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(https://www.maplestory.work/images/home.jpg) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="https://www.maplestory.work" class="logo"><img src="https://www.maplestory.work/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">C# 委托 </h1> <ul class="tags"> <li><a href="https://www.maplestory.work/tags#C#">C#</a></li> </ul> <div class="section-line reverse"><a href="https://www.maplestory.work/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">18 May 2019</div> <center><h2><b>C# 委托</b></h2></center> <p><br /></p> <ul> <li><strong>委托的概念</strong>：<br /></li> </ul> <p> 委托是一个类，它定义了方法的类型，使一个方法可以当作另一个方法的参数来进行传递，这种将方法动态地赋给参数的做法，可以避免在程序中大量使用If-Else(Switch)语句，同时使得程序具有更好的可扩展性。。</p> <ul> <li> <p><strong>常见委托的使用</strong>：<br /></p> <blockquote> <div class="highlighter-rouge"><pre class="highlight"><code><span class="k">delegate</span> <span class="kt">int</span> <span class="nf">MethodDelegate</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">inty</span><span class="p">);</span>

<span class="n">MethodDelegate</span> <span class="n">method</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MethodDelegate</span><span class="p">(</span><span class="n">function_name</span><span class="p">);</span>
</code></pre></div> </blockquote> <blockquote> <div class="highlighter-rouge"><pre class="highlight"><code> <span class="n">MethodDelegate</span> <span class="n">method</span> <span class="p">=</span> <span class="n">function_name</span><span class="p">;</span>
</code></pre></div> </blockquote> <p> <strong>将对应的函数名放入function_name位置，函数的签名需要和委托声明的一样。</strong></p> <blockquote> <div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//使用匿名方法
</span><span class="n">MyDelegate</span> <span class="n">myDelegate</span> <span class="p">=</span> <span class="k">delegate</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="p">+</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">//使用Lambda表达式
</span><span class="n">MyDelegate</span> <span class="n">myDelegateLambda</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="p">+</span> <span class="n">y</span><span class="p">;</span> <span class="p">};</span>
</code></pre></div> </blockquote> </li> <li> <p><strong>其他委托的分类</strong>：</p> <p><strong>1.Action</strong></p> <p>Action作为一种反省委托，不具备返回值</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Test</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="n">Action</span><span class="p">,</span><span class="s">"Hello World!"</span><span class="p">);</span>
            <span class="n">Test</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">Action</span><span class="p">,</span> <span class="m">1000</span><span class="p">);</span>
            <span class="n">Test</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"{0}"</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span> <span class="p">},</span> <span class="s">"Hello World"</span><span class="p">);</span>
    		<span class="c1">//使用Lambda表达式定义委托
</span>            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadKey</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">Test</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">action</span><span class="p">,</span> <span class="n">T</span> <span class="n">p</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">Action</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Action</span><span class="p">(</span><span class="kt">string</span> <span class="n">s</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Action</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div> <p><strong>2.Func</strong></p> <p>Func是返回值的泛型委托</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">Test</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">Fun</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">200</span><span class="p">));</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadKey</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">Test</span><span class="p">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">&gt;(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span> <span class="n">func</span><span class="p">,</span> <span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">Fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div> <p><strong>3.predicate</strong>：</p> <p>predicate是返回值bool的泛型委托</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="k">public</span> <span class="k">delegate</span> <span class="kt">int</span> <span class="nf">MethodDelegate</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">MethodDelegate</span> <span class="n">method</span><span class="p">;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">method</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MethodDelegate</span><span class="p">(</span><span class="n">Add</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="nf">method</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">20</span><span class="p">));</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadKey</span><span class="p">();</span>
        <span class="p">}</span>
  
        <span class="k">private</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">x</span> <span class="p">+</span> <span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div> </li> <li> <p><strong>委托的好处</strong>：</p> <ol> <li> <p>相当于用方法作为另一方法参数(类似于C的函数指针)</p> </li> <li> <p>在两个不能直接调用的方法中作为桥梁,如:在多线程中的跨线程的方法调用就得用委托</p> </li> <li> <p>当不知道方法具体实现什么时使用委托,如:事件中使用委托</p> </li> </ol> </li> <li> <p><strong>注意事项与特点</strong>：<br /></p> <p> 1. 虽然委托的定义有点像方法的声明，但是委托是属于类的层面。</p> <p> 2. 委托类似于C++的函数指针，但是它是类型安全的</p> <p> 3.委托允许将方法作为参数进行传递。</p> <p> 4. Delegate至少0个参数，至多32个参数，可以无返回值，也可以指定返回值类型</p> <p>　5. Func可以接受0个至16个传入参数，必须具有返回值</p> <p>　6. Action可以接受0个至16个传入参数，无返回值</p> <p>　7 Predicate只能接受一个传入参数，返回值为bool类型</p> </li> </ul> <p>相关博客：</p> <p>​ <a href="https://www.cnblogs.com/yinqixin/p/5056307.html">分分钟用上C#中的委托和事件</a> （该文学习将委托是事件结合，从而实现一个对象发送指令，其他的对象根据不同指令进行自己的操作的功能）</p> <p>​</p> <p>Thanks to <a href="https://www.cnblogs.com/zhangchenliang/">Danny Chen</a></p> <br> <nav class="pagination"> <a href="https://www.maplestory.work/Intel-.hex-file/" class="pagination_pager" title=".HEX file ">previous</a> <a href="https://www.maplestory.work/C-%E8%AE%BF%E9%97%AEUI%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E6%B3%95/" class="pagination_pager" title="C# 访问UI线程 ">next</a> </nav> </div> </div> <!-- JS --> <script src="https://www.maplestory.work/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://www.maplestory.work/images/benjamin-deyoung-unsplash.jpg) center center no-repeat;"> <a href="https://github.com/Maple-Chan" target="_blank" rel="nofollow external"> <span> GitHub Home </span> </a> </li> </ul> </div> </body> </html>
